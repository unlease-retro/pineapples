buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.netflix.nebula:gradle-ospackage-plugin:1.12.2'
    }
}

plugins {
    id "nebula.ospackage" version "3.2.0"
}


apply plugin: 'nebula.deb'

project.ext.set('env', System.getenv())

task cleanDir(type: Delete) {
  delete 'build', 'node_modules'
}
task installNpm(type: Exec ) {
    dependsOn << cleanDir
    commandLine = ["npm", "install"]
    inputs.file "package.json"
    outputs.dir "node_modules"
}
task npmBuild(type: Exec ) {
    dependsOn << installNpm
    commandLine = ["npm", "run", "build"]
}
task copyDocs(type: Copy) {
    dependsOn << npmBuild
    from 'node_modules'
    into 'build/node_modules'
}

task makeDeb(type: Deb) {
    dependsOn << copyDocs
    user = 'deploy'
    version = '0.' + (env.containsKey("GIT_COMMIT") ? env.GIT_COMMIT : '0.0')
    packageName = 'unlease-app'
    postInstall file('buildScripts/deb-postInstall.sh')

    into '/opt/unlease/app/'
    from('build/') {

    }
}

repositories {
    mavenCentral()
}



task wrapper(type: Wrapper) {
    gradleVersion = '2.3'
}

